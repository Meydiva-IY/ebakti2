"use strict";var jwt=require("jsonwebtoken"),bcrypt=require("bcrypt"),User=require("../models/User");exports.register=function(r,t){var s,n,a,d,o,i,u,c,m,p,l;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.body,n=s.email,a=s.password,d=s.name,o=s.gender,i=s.date_of_birth,u=s.student_id,c=s.department,m=s.address,e.prev=1,e.next=4,regeneratorRuntime.awrap(bcrypt.hash(a,10));case 4:return p=e.sent,e.next=7,regeneratorRuntime.awrap(User.create({role:"peserta",email:n,password:p,name:d,gender:o,date_of_birth:i,student_id:u,department:c,address:m}));case 7:l=e.sent,t.status(201).json({message:"Registration successful",user:{id:l.user_id,email:l.email,name:l.name,gender:l.gender,date_of_birth:l.date_of_birth,student_id:l.student_id,department:l.department,address:l.address}}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),console.error("Error during registration:",e.t0.message),t.status(500).json({error:e.t0.message});case 15:case"end":return e.stop()}},null,null,[[1,11]])},exports.login=function(r,t){var s,n,a,d,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.body,n=s.email,a=s.password,e.prev=1,e.next=4,regeneratorRuntime.awrap(User.findOne({where:{email:n}}));case 4:if(d=e.sent){e.next=7;break}return e.abrupt("return",t.status(404).json({error:"Email tidak ditemukan"}));case 7:return e.next=9,regeneratorRuntime.awrap(bcrypt.compare(a,d.password));case 9:if(e.sent){e.next=12;break}return e.abrupt("return",t.status(401).json({error:"Password salah"}));case 12:o=jwt.sign({id:d.user_id,role:d.role},process.env.JWT_SECRET,{expiresIn:"24h"}),t.json({message:"Login successful",token:o,user:{id:d.user_id,email:d.email,name:d.name,gender:d.gender,date_of_birth:d.date_of_birth,student_id:d.student_id,department:d.department,address:d.address}}),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),console.error("Error during login:",e.t0.message),t.status(500).json({error:e.t0.message});case 20:case"end":return e.stop()}},null,null,[[1,16]])};
//# sourceMappingURL=userController.min.js.map
